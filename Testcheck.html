<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preventive Maintenance and Verification Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        @media print {
            body { -webkit-print-color-adjust: exact; color-adjust: exact; }
            .no-print { display: none; }
            .print-view { display: block !important; }
            #form-view, #review-view { display: none; }
        }
        .status-dot {
            height: 12px;
            width: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        .status-pass { background-color: #28a745; }
        .status-fail { background-color: #dc3545; }
        .status-pending { background-color: #6c757d; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- ===== Main Form View ===== -->
    <div id="form-view">
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <!-- Header -->
            <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-700 mb-2">รายงานการบำรุงรักษาและทวนสอบ</h1>
                <p class="text-lg text-gray-500">Temperature Transmitter</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div>
                        <label for="plant" class="block text-sm font-medium text-gray-600 mb-1">โรงงาน</label>
                        <input type="text" id="plant" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" placeholder="เช่น อธิมาตร">
                    </div>
                    <div>
                        <label for="department" class="block text-sm font-medium text-gray-600 mb-1">ส่วนงาน</label>
                        <input type="text" id="department" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" placeholder="เช่น กลั่นสุรา">
                    </div>
                    <div>
                        <label for="check-date" class="block text-sm font-medium text-gray-600 mb-1">ว/ด/ป ตรวจเช็ค</label>
                        <input type="date" id="check-date" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>
            </div>

            <!-- Equipment List Container -->
            <div id="equipment-list"></div>

            <!-- Action Buttons -->
            <div class="mt-8">
                 <button onclick="showReviewPage()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                    ตรวจสอบและสรุปผล
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ===== Review Page View ===== -->
    <div id="review-view" class="hidden">
        <div class="container mx-auto p-4 md:p-8 max-w-6xl">
            <div class="bg-white p-6 rounded-xl shadow-md">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-700 mb-4">สรุปผลการตรวจสอบ</h1>
                 <div id="review-header-info" class="mb-6 p-4 bg-gray-50 rounded-lg text-gray-600"></div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ลำดับ</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รหัส</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">หลักการทำงาน</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ (1/2/3/4)</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รายการแก้ไข</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="review-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Review rows will be inserted here -->
                        </tbody>
                    </table>
                </div>

                <div class="mt-8 flex flex-col sm:flex-row gap-4">
                    <button onclick="showFormPage()" class="w-full sm:w-auto bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition">
                        กลับไปแก้ไข
                    </button>
                    <button onclick="printReport()" class="w-full sm:w-auto flex-grow bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition">
                        ยืนยันและพิมพ์รายงาน
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Print View ===== -->
    <div id="print-view" class="hidden">
        <div class="container mx-auto p-4">
            <div class="text-center mb-6">
                 <h1 class="text-2xl font-bold">รายงานการบำรุงรักษาและทวนสอบ - Temperature Transmitter</h1>
                 <div id="print-header-info" class="mt-2 text-lg"></div>
            </div>
            <div id="print-table-container"></div>
        </div>
    </div>

    <script>
    // --- MASTER DATA ---
    const equipmentMasterList = [
        { code: "TT-012", description: "วัดอุณหภูมิน้ำหล่อเย็นออกจาก Condenser Re2" },
        { code: "TT-013", description: "วัดอุณหภูมิน้ำหล่อเย็นออกจาก Condenser R2" },
        { code: "TT-015", description: "ท่อส่าส่งเข้าหอกลั่น (วัดอุณหภูมิน้ำส่าเข้าหอกลั่น)" },
        { code: "TT-016", description: "ก้นหอ D (วัดอุณหภูมิน้ำกากส่าออกจากก้นหอ D)" },
        { code: "TI-019", description: "Condenser (วัดอุณหภูมิน้ำหล่อเย็นเข้า Condenser)" },
        { code: "TT-110", description: "วัดอุณหภูมิกั้นหอ D" },
        { code: "TI-111", description: "วัดอุณหภูมิ Tray 3 ก้นหอ D" },
        { code: "TI-113", description: "วัดอุณหภูมิยอดหอ D" },
        { code: "TI-210", description: "วัดอุณหภูมิกั้นหอ H" },
        { code: "TI-211", description: "วัดอุณหภูมิยอดหอ H" },
        { code: "TI-310", description: "วัดอุณหภูมิกั้นหอ Re" },
        { code: "TI-313", description: "วัดอุณหภูมิ Condenser Re4" },
        { code: "TT-410", description: "วัดอุณหภูมิกั้นพอ R" },
        { code: "TI-413", description: "วัดอุณหภูมิ Condenser R1" },
        { code: "TI-416", description: "วัดอุณหภูมิยอดหอ R" },
    ];

    const inspectionItems = ["สายสัญญาณสำหรับ RTD", "ฝาปิดครอบสำหรับ RTD", "บอดี้สำหรับ RTD", "ภายในบอดี้สำหรับ RTD"];

    // --- CARD CREATION AND MANAGEMENT ---
    function createEquipmentCard(equipment, index) {
        const list = document.getElementById('equipment-list');
        const cardId = `card-${index}`;
        const card = document.createElement('div');
        card.id = cardId;
        card.className = "bg-white p-6 rounded-xl shadow-md mb-6";
        card.dataset.index = index; // Store original index

        const inspectionButtonsHtml = inspectionItems.map((item, i) => `
            <div class="flex items-center justify-between py-3 border-b border-gray-200">
                <span class="text-gray-700">${i + 1}. ${item}</span>
                <div class="flex gap-2" data-status-group="${i}">
                    <button onclick="selectStatus(this, 'pass')" class="status-button pass-button bg-gray-200 hover:bg-green-200 text-gray-600 font-semibold py-1 px-4 rounded-full transition">ผ่าน</button>
                    <button onclick="selectStatus(this, 'fail')" class="status-button fail-button bg-gray-200 hover:bg-red-200 text-gray-600 font-semibold py-1 px-4 rounded-full transition">ไม่ผ่าน</button>
                </div>
            </div>
        `).join('');

        card.innerHTML = `
            <h2 class="text-xl font-bold text-gray-700 mb-4">อุปกรณ์ #${index + 1}</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">รหัส (Code)</label>
                    <p class="code-text w-full p-2 border border-gray-200 bg-gray-50 rounded-md text-gray-800 font-medium">${equipment.code}</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">หลักการทำงาน / ตำแหน่ง</label>
                    <p class="desc-text w-full p-2 border border-gray-200 bg-gray-50 rounded-md text-gray-600 min-h-[42px]">${equipment.description}</p>
                </div>
            </div>
            <h3 class="text-lg font-semibold text-gray-600 mb-2 border-t pt-4">สถานะรายละเอียดการตรวจสอบ</h3>
            <div class="space-y-2">${inspectionButtonsHtml}</div>
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-600 mb-1">รายการแก้ไข / ปรับแต่ง / ซ่อมแซม</label>
                <textarea rows="3" class="notes-text w-full p-2 border border-gray-300 rounded-md shadow-sm" placeholder="กรอกรายละเอียดการซ่อมแซม..."></textarea>
            </div>
        `;
        list.appendChild(card);
    }

    function selectStatus(button, status) {
        const group = button.parentElement;
        const passButton = group.querySelector('.pass-button');
        const failButton = group.querySelector('.fail-button');

        passButton.classList.remove('bg-green-500', 'text-white');
        failButton.classList.remove('bg-red-500', 'text-white');
        passButton.classList.add('bg-gray-200', 'text-gray-600');
        failButton.classList.add('bg-gray-200', 'text-gray-600');

        if (status === 'pass') button.classList.add('bg-green-500', 'text-white');
        else button.classList.add('bg-red-500', 'text-white');
    }

    // --- PAGE NAVIGATION ---
    const formView = document.getElementById('form-view');
    const reviewView = document.getElementById('review-view');

    function showReviewPage() {
        generateReviewTable();
        formView.classList.add('hidden');
        reviewView.classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    function showFormPage() {
        formView.classList.remove('hidden');
        reviewView.classList.add('hidden');
    }
    
    function editCard(cardId) {
        showFormPage();
        setTimeout(() => {
            const cardElement = document.getElementById(cardId);
            if(cardElement) {
                cardElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                cardElement.classList.add('ring-2', 'ring-blue-500', 'ring-offset-2');
                setTimeout(() => cardElement.classList.remove('ring-2', 'ring-blue-500', 'ring-offset-2'), 2000);
            }
        }, 100);
    }
    
    function deleteCardFromReview(cardId) {
        if (confirm('คุณแน่ใจหรือไม่ว่าต้องการลบรายการนี้?')) {
            const cardElement = document.getElementById(cardId);
            const reviewRowElement = document.querySelector(`tr[data-card-id="${cardId}"]`);
            if(cardElement) cardElement.remove();
            if(reviewRowElement) reviewRowElement.remove();
        }
    }


    // --- REVIEW PAGE LOGIC ---
    function generateReviewTable() {
        const reviewBody = document.getElementById('review-table-body');
        reviewBody.innerHTML = ''; // Clear existing table

        // Populate header
        const plant = document.getElementById('plant').value || 'ไม่ได้ระบุ';
        const department = document.getElementById('department').value || 'ไม่ได้ระบุ';
        const checkDate = document.getElementById('check-date').value || 'ไม่ได้ระบุ';
        const reviewHeaderInfo = document.getElementById('review-header-info');
        reviewHeaderInfo.innerHTML = `<strong>โรงงาน:</strong> ${plant}&nbsp;&nbsp;&nbsp;<strong>ส่วนงาน:</strong> ${department}&nbsp;&nbsp;&nbsp;<strong>วันที่:</strong> ${checkDate}`;
        
        const cards = document.querySelectorAll('#equipment-list .bg-white');
        cards.forEach((card, index) => {
            const code = card.querySelector('.code-text').textContent;
            const desc = card.querySelector('.desc-text').textContent;
            const notes = card.querySelector('.notes-text').value;
            const cardId = card.id;

            const statusDots = inspectionItems.map((_, i) => {
                const statusGroup = card.querySelector(`div[data-status-group="${i}"]`);
                if (statusGroup.querySelector('.pass-button.bg-green-500')) return '<span class="status-dot status-pass"></span>';
                if (statusGroup.querySelector('.fail-button.bg-red-500')) return '<span class="status-dot status-fail"></span>';
                return '<span class="status-dot status-pending"></span>';
            }).join('&nbsp;');

            const row = document.createElement('tr');
            row.dataset.cardId = cardId;
            row.innerHTML = `
                <td class="px-4 py-3 whitespace-nowrap">${index + 1}</td>
                <td class="px-4 py-3 whitespace-nowrap font-medium">${code}</td>
                <td class="px-4 py-3">${desc}</td>
                <td class="px-4 py-3 text-center">${statusDots}</td>
                <td class="px-4 py-3 text-sm text-gray-600">${notes || '-'}</td>
                <td class="px-4 py-3 whitespace-nowrap text-center text-sm font-medium">
                    <button onclick="editCard('${cardId}')" class="text-indigo-600 hover:text-indigo-900">แก้ไข</button>
                    <span class="mx-1 text-gray-300">|</span>
                    <button onclick="deleteCardFromReview('${cardId}')" class="text-red-600 hover:text-red-900">ลบ</button>
                </td>
            `;
            reviewBody.appendChild(row);
        });
    }

    // --- PRINTING LOGIC ---
    function printReport() {
        // Populate header
        const plant = document.getElementById('plant').value || 'ไม่ได้ระบุ';
        const department = document.getElementById('department').value || 'ไม่ได้ระบุ';
        const checkDate = document.getElementById('check-date').value || 'ไม่ได้ระบุ';
        document.getElementById('print-header-info').innerHTML = `<p><strong>โรงงาน:</strong> ${plant}&nbsp;&nbsp;<strong>ส่วนงาน:</strong> ${department}&nbsp;&nbsp;<strong>วันที่:</strong> ${checkDate}</p>`;
        
        // Clone review table for printing
        const reviewTable = document.querySelector('#review-view table').cloneNode(true);
        // Remove the "Manage" column
        reviewTable.querySelectorAll('tr').forEach(tr => tr.deleteCell(-1));
        
        const printContainer = document.getElementById('print-table-container');
        printContainer.innerHTML = '';
        printContainer.appendChild(reviewTable);

        window.print();
    }
    
    // --- INITIALIZATION ---
    window.onload = () => {
        document.getElementById('check-date').valueAsDate = new Date();
        equipmentMasterList.forEach((eq, index) => createEquipmentCard(eq, index));
    };
    </script>
</body>
</html>